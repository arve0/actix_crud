var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function s(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(t,e,n){t.$$.on_destroy.push(function(t,e){const n=t.subscribe(e);return n.unsubscribe?()=>n.unsubscribe():n}(e,n))}function a(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function d(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function f(){return l(" ")}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function m(t,e){e=""+e,t.data!==e&&(t.data=e)}function $(t,e){(null!=e||t.value)&&(t.value=e)}let g;function v(t){g=t}function b(){const t=g;return(e,n)=>{const o=t.$$.callbacks[e];if(o){const s=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,s)})}}}const w=[],y=[],_=[],x=[],k=Promise.resolve();let E=!1;function C(t){_.push(t)}function L(){const t=new Set;do{for(;w.length;){const t=w.shift();v(t),T(t.$$)}for(;y.length;)y.pop()();for(let e=0;e<_.length;e+=1){const n=_[e];t.has(n)||(n(),t.add(n))}_.length=0}while(w.length);for(;x.length;)x.pop()();E=!1}function T(t){t.fragment&&(t.update(t.dirty),o(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(C))}const N=new Set;let j;function S(){j={r:0,c:[],p:j}}function D(){j.r||o(j.c),j=j.p}function O(t,e){t&&t.i&&(N.delete(t),t.i(e))}function P(t,e,n,o){if(t&&t.o){if(N.has(t))return;N.add(t),j.c.push(()=>{N.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function R(t,e){t.d(1),e.delete(t.key)}function M(t,n,c){const{fragment:r,on_mount:a,on_destroy:u,after_update:i}=t.$$;r.m(n,c),C(()=>{const n=a.map(e).filter(s);u?u.push(...n):o(n),t.$$.on_mount=[]}),i.forEach(C)}function I(t,e){t.$$.fragment&&(o(t.$$.on_destroy),t.$$.fragment.d(e),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={})}function H(t,e){t.$$.dirty||(w.push(t),E||(E=!0,k.then(L)),t.$$.dirty=n()),t.$$.dirty[e]=!0}function A(e,s,c,r,a,u){const i=g;v(e);const d=s.props||{},l=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:n(),dirty:null};let f=!1;var p;l.ctx=c?c(e,d,(t,n)=>{l.ctx&&a(l.ctx[t],l.ctx[t]=n)&&(l.bound[t]&&l.bound[t](n),f&&H(e,t))}):d,l.update(),f=!0,o(l.before_update),l.fragment=r(l.ctx),s.target&&(s.hydrate?l.fragment.l((p=s.target,Array.from(p.childNodes))):l.fragment.c(),s.intro&&O(e.$$.fragment),M(e,s.target,s.anchor),L()),v(i)}class J{$destroy(){I(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function U(e){var n,o,s,c,r,p,m,$,g,v,b,w,y,_,x;return{c(){n=d("h1"),o=l(e.prettyType),s=f(),c=d("form"),(r=d("label")).textContent="Username",p=f(),m=d("input"),$=f(),(g=d("label")).textContent="Password",v=f(),b=d("input"),w=f(),y=d("button"),_=l(e.prettyType),h(r,"for","username"),h(r,"class","svelte-d00odx"),h(m,"id","username"),h(m,"name","username"),h(g,"for","password"),h(g,"class","svelte-d00odx"),h(b,"id","password"),h(b,"name","password"),h(b,"type","password"),h(y,"type","submit"),h(y,"class","button svelte-d00odx"),h(c,"action",x="/user/"+e.type),h(c,"method","POST")},m(t,e){u(t,n,e),a(n,o),u(t,s,e),u(t,c,e),a(c,r),a(c,p),a(c,m),a(c,$),a(c,g),a(c,v),a(c,b),a(c,w),a(c,y),a(y,_)},p(t,e){t.type&&x!==(x="/user/"+e.type)&&h(c,"action",x)},i:t,o:t,d(t){t&&(i(n),i(s),i(c))}}}function q(t,e,n){let{type:o="login"}=e,s=o[0].toUpperCase()+o.slice(1);return t.$set=(t=>{"type"in t&&n("type",o=t.type)}),{type:o,prettyType:s}}class B extends J{constructor(t){super(),A(this,t,q,U,c,["type"])}}const z=[];function F(t,e){return{subscribe:G(t,e).subscribe}}function G(e,n=t){let o;const s=[];function r(t){if(c(e,t)&&(e=t,o)){const t=!z.length;for(let t=0;t<s.length;t+=1){const n=s[t];n[1](),z.push(n,e)}if(t){for(let t=0;t<z.length;t+=2)z[t][0](z[t+1]);z.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(c,a=t){const u=[c,a];return s.push(u),1===s.length&&(o=n(r)||t),c(e),()=>{const t=s.indexOf(u);-1!==t&&s.splice(t,1),0===s.length&&(o(),o=null)}}}}const K=fetch("/user").then(t=>200!==t.status?null:t.text()),Q=F(null,t=>{K.then(t)}),V=F(!1,t=>{K.then(t=>null!==t).then(t)}),W=K.then(t=>null!==t),X="/document",Y=W.then(t=>t?fetch(X):{}).then(t=>200!==t.status?[]:t.json()),{set:Z,subscribe:tt,update:et}=G([],t=>Y.then(t));const nt=new EventSource("/updates");nt.addEventListener("insert",t=>{let e=JSON.parse(t.data);et(t=>[...t,e])}),nt.addEventListener("update",t=>{let e=JSON.parse(t.data);et(t=>t.map(t=>t.id===e.id?e:t))}),nt.addEventListener("delete",t=>{let e=t.data;et(t=>t.filter(t=>t.id!==e))});const ot={create:async function(t){let e=await fetch(X,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)});if(201!==e.status){let t=await e.text();throw new Error(`HTTP status ${e.status}, message '${t}'`)}let n=await e.text();et(e=>[...e,{id:n,data:t}])},delete_:async function(t){let e=await fetch(`${X}/${t}`,{method:"DELETE"});if(200!==e.status){let t=await e.text();throw new Error(`HTTP status ${e.status}, message '${t}'`)}et(e=>{const n=e.findIndex(e=>e.id===t);if(-1===n)throw new Error(`Expected to find id ${t}, but did not.`);return[...e.slice(0,n),...e.slice(n+1)]})},subscribe:tt,put:async function(t){let{id:e,data:n}=t,o=await fetch(`${X}/${e}`,{method:"PUT",headers:{"content-type":"application/json"},body:JSON.stringify(n)});if(200!==o.status){let t=await o.text();throw new Error(`HTTP status ${o.status}, message '${t}'`)}et(n=>{const o=n.findIndex(t=>t.id===e);if(-1===o)throw new Error(`Expected to find id ${e}, but did not.`);return[...n.slice(0,o),t,...n.slice(o+1)]})}};function st(e){var n,s,c,r,g,v,b,w,y,_,x,k,E,C,L,T,N,j,S,D,O,P,R,M,I,H;return{c(){n=d("h2"),s=l(e.title),c=l(" document"),r=f(),g=d("form"),(v=d("label")).textContent="Date",b=f(),w=d("input"),y=f(),(_=d("label")).textContent="Description",x=f(),k=d("input"),E=f(),(C=d("label")).textContent="Amount",L=f(),T=d("input"),N=f(),(j=d("label")).textContent="Done",S=f(),D=d("input"),O=f(),P=d("div"),(R=d("button")).textContent="Save",M=f(),(I=d("button")).textContent="Cancel",h(n,"class","subtitle"),h(v,"for","date"),h(v,"class","svelte-belg7s"),h(w,"id","date"),h(w,"type","date"),h(_,"for","description"),h(_,"class","svelte-belg7s"),h(k,"id","description"),h(k,"type","text"),h(C,"for","amount"),h(C,"class","svelte-belg7s"),h(T,"id","amount"),h(T,"type","number"),h(j,"for","done"),h(j,"class","svelte-belg7s"),h(D,"id","done"),h(D,"type","checkbox"),h(R,"type","submit"),h(P,"class","action svelte-belg7s"),H=[p(w,"input",e.input0_input_handler),p(k,"input",e.input1_input_handler),p(T,"input",e.input2_input_handler),p(D,"change",e.input3_change_handler),p(I,"click",e.click_handler),p(g,"submit",e.submit)]},m(t,o){u(t,n,o),a(n,s),a(n,c),u(t,r,o),u(t,g,o),a(g,v),a(g,b),a(g,w),$(w,e.data.date),a(g,y),a(g,_),a(g,x),a(g,k),$(k,e.data.description),a(g,E),a(g,C),a(g,L),a(g,T),$(T,e.data.amount),a(g,N),a(g,j),a(g,S),a(g,D),D.checked=e.data.done,a(g,O),a(g,P),a(P,R),a(P,M),a(P,I)},p(t,e){t.title&&m(s,e.title),t.data&&$(w,e.data.date),t.data&&k.value!==e.data.description&&$(k,e.data.description),t.data&&$(T,e.data.amount),t.data&&(D.checked=e.data.done)},i:t,o:t,d(t){t&&(i(n),i(r),i(g)),o(H)}}}function ct(t,e,n){let{document:o}=e;const s=b();let c,r,a;return t.$set=(t=>{"document"in t&&n("document",o=t.document)}),t.$$.update=((t={document:1,isNew:1})=>{t.document&&n("data",c=o.data),t.document&&n("isNew",r=null===o.id),t.isNew&&n("title",a=r?"New":"Edit")}),{document:o,dispatch:s,submit:function(t){t.preventDefault(),r?ot.create(c).then(()=>s("done")):ot.put(o).then(()=>s("done"))},data:c,title:a,input0_input_handler:function(){c.date=this.value,n("data",c),n("document",o)},input1_input_handler:function(){c.description=this.value,n("data",c),n("document",o)},input2_input_handler:function(){var t;c.amount=""===(t=this.value)?void 0:+t,n("data",c),n("document",o)},input3_change_handler:function(){c.done=this.checked,n("data",c),n("document",o)},click_handler:function(){return s("done")}}}class rt extends J{constructor(t){super(),A(this,t,ct,st,c,["document"])}}function at(t,e,n){const o=Object.create(t);return o.doc=e[n],o}function ut(t){var e,n,o,s=[],c=new Map,r=t.$documents;const l=t=>t.doc.id;for(var p=0;p<r.length;p+=1){let e=at(t,r,p),n=l(e);c.set(n,s[p]=it(n,e))}return{c(){for(e=d("table"),(n=d("thead")).innerHTML='<tr><th class="svelte-1fv41r1">date</th> <th class="svelte-1fv41r1">description</th> <th class="svelte-1fv41r1">amount</th> <th class="svelte-1fv41r1">done</th> <th class="svelte-1fv41r1">actions</th></tr>',o=f(),p=0;p<s.length;p+=1)s[p].c();h(e,"class","table svelte-1fv41r1")},m(t,c){for(u(t,e,c),a(e,n),a(e,o),p=0;p<s.length;p+=1)s[p].m(e,null)},p(t,n){const o=n.$documents;s=function(t,e,n,o,s,c,r,a,u,i,d,l){let f=t.length,p=c.length,h=f;const m={};for(;h--;)m[t[h].key]=h;const $=[],g=new Map,v=new Map;for(h=p;h--;){const t=l(s,c,h),a=n(t);let u=r.get(a);u?o&&u.p(e,t):(u=i(a,t)).c(),g.set(a,$[h]=u),a in m&&v.set(a,Math.abs(h-m[a]))}const b=new Set,w=new Set;function y(t){O(t,1),t.m(a,d),r.set(t.key,t),d=t.first,p--}for(;f&&p;){const e=$[p-1],n=t[f-1],o=e.key,s=n.key;e===n?(d=e.first,f--,p--):g.has(s)?!r.has(o)||b.has(o)?y(e):w.has(s)?f--:v.get(o)>v.get(s)?(w.add(o),y(e)):(b.add(s),f--):(u(n,r),f--)}for(;f--;){const e=t[f];g.has(e.key)||u(e,r)}for(;p;)y($[p-1]);return $}(s,t,l,1,n,o,c,e,R,it,null,at)},d(t){for(t&&i(e),p=0;p<s.length;p+=1)s[p].d()}}}function it(t,e){var n,s,c,r,$,g,v,b,w,y,_,x,k,E,C,L,T,N,j,S=e.doc.data.date+"",D=e.doc.data.description+"",O=e.doc.data.amount+"",P=e.doc.data.done?"✅":"❌";function R(){return e.click_handler(e)}function M(){return e.click_handler_1(e)}return{key:t,first:null,c(){n=d("tr"),s=d("td"),c=l(S),r=f(),$=d("td"),g=l(D),v=f(),b=d("td"),w=l(O),y=f(),_=d("td"),x=l(P),k=f(),E=d("td"),(C=d("button")).textContent="Edit",L=f(),(T=d("button")).textContent="Delete",N=f(),h(s,"class","svelte-1fv41r1"),h($,"class","svelte-1fv41r1"),h(b,"class","svelte-1fv41r1"),h(_,"class","svelte-1fv41r1"),h(C,"class","svelte-1fv41r1"),h(T,"class","svelte-1fv41r1"),h(E,"class","svelte-1fv41r1"),j=[p(C,"click",R),p(T,"click",M)],this.first=n},m(t,e){u(t,n,e),a(n,s),a(s,c),a(n,r),a(n,$),a($,g),a(n,v),a(n,b),a(b,w),a(n,y),a(n,_),a(_,x),a(n,k),a(n,E),a(E,C),a(E,L),a(E,T),a(n,N)},p(t,n){e=n,t.$documents&&S!==(S=e.doc.data.date+"")&&m(c,S),t.$documents&&D!==(D=e.doc.data.description+"")&&m(g,D),t.$documents&&O!==(O=e.doc.data.amount+"")&&m(w,O),t.$documents&&P!==(P=e.doc.data.done?"✅":"❌")&&m(x,P)},d(t){t&&i(n),o(j)}}}function dt(e){var n,o;return{c(){(n=d("button")).textContent="Create new document",o=p(n,"click",e.create)},m(t,e){u(t,n,e)},p:t,i:t,o:t,d(t){t&&i(n),o()}}}function lt(t){var e,n=new rt({props:{document:t.document}});return n.$on("done",t.done),{c(){n.$$.fragment.c()},m(t,o){M(n,t,o),e=!0},p(t,e){var o={};t.document&&(o.document=e.document),n.$set(o)},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){P(n.$$.fragment,t),e=!1},d(t){I(n,t)}}}function ft(t){var e,n,o,s,c,r,a,p=t.$documents.length&&ut(t),h=[lt,dt],m=[];function $(t,e){return e.show_input_form?0:1}return s=$(0,t),c=m[s]=h[s](t),{c(){(e=d("h1")).textContent="Documents",n=f(),p&&p.c(),o=f(),c.c(),r=l("")},m(t,c){u(t,e,c),u(t,n,c),p&&p.m(t,c),u(t,o,c),m[s].m(t,c),u(t,r,c),a=!0},p(t,e){e.$documents.length?p?p.p(t,e):((p=ut(e)).c(),p.m(o.parentNode,o)):p&&(p.d(1),p=null);var n=s;(s=$(0,e))===n?m[s].p(t,e):(S(),P(m[n],1,1,()=>{m[n]=null}),D(),(c=m[s])||(c=m[s]=h[s](e)).c(),O(c,1),c.m(r.parentNode,r))},i(t){a||(O(c),a=!0)},o(t){P(c),a=!1},d(t){t&&(i(e),i(n)),p&&p.d(t),t&&i(o),m[s].d(t),t&&i(r)}}}function pt(t,e,n){let o;r(t,ot,t=>{n("$documents",o=t)});let s=!1,c={};function a(t){n("document",c=t),n("show_input_form",s=!0)}function u(t){c.id===t&&(n("show_input_form",s=!1),n("document",c={})),ot.delete_(t)}return{show_input_form:s,document:c,create:function(){n("document",c={id:null,data:{date:"",description:"",amount:0,done:!1}}),n("show_input_form",s=!0)},edit:a,done:function(){n("show_input_form",s=!1),n("document",c={})},delete_:u,$documents:o,click_handler:function({doc:t}){return a(t)},click_handler_1:function({doc:t}){return u(t.id)}}}class ht extends J{constructor(t){super(),A(this,t,pt,ft,c,[])}}function mt(e){var n,o;return{c(){(n=d("button")).textContent="Register",h(n,"class","svelte-b1nvja"),o=p(n,"click",e.showRegisterDialog)},m(t,e){u(t,n,e)},p:t,d(t){t&&i(n),o()}}}function $t(e){var n,o;return{c(){(n=d("button")).textContent="Log in",h(n,"class","svelte-b1nvja"),o=p(n,"click",e.showLoginDialog)},m(t,e){u(t,n,e)},p:t,d(t){t&&i(n),o()}}}function gt(t){var e,n,o,s;return{c(){e=d("a"),n=l("Logout ("),o=l(t.$username),s=l(")"),h(e,"class","button svelte-b1nvja"),h(e,"href","/user/logout")},m(t,c){u(t,e,c),a(e,n),a(e,o),a(e,s)},p(t,e){t.$username&&m(o,e.$username)},d(t){t&&i(e)}}}function vt(t){var e,n=new B({props:{type:"register"}});return{c(){n.$$.fragment.c()},m(t,o){M(n,t,o),e=!0},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){P(n.$$.fragment,t),e=!1},d(t){I(n,t)}}}function bt(t){var e,n=new B({});return{c(){n.$$.fragment.c()},m(t,o){M(n,t,o),e=!0},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){P(n.$$.fragment,t),e=!1},d(t){I(n,t)}}}function wt(t){var e,n=new ht({});return{c(){n.$$.fragment.c()},m(t,o){M(n,t,o),e=!0},i(t){e||(O(n.$$.fragment,t),e=!0)},o(t){P(n.$$.fragment,t),e=!1},d(t){I(n,t)}}}function yt(t){var e,n,o,s,c,r,l,p,m,$,g;function v(t,e){return e.$loggedIn?gt:e.showRegister?$t:e.showLogin?mt:void 0}var b=v(0,t),w=b&&b(t),y=[wt,bt,vt],_=[];function x(t,e){return e.$loggedIn?0:e.showLogin?1:e.showRegister?2:-1}return~(m=x(0,t))&&($=_[m]=y[m](t)),{c(){e=d("header"),(n=d("div")).innerHTML='<a href="/">actix crud</a>',o=f(),s=d("div"),c=f(),r=d("div"),w&&w.c(),l=f(),p=d("main"),$&&$.c(),h(n,"class","brand svelte-b1nvja"),h(s,"class","menu"),h(r,"class","login"),h(e,"class","svelte-b1nvja"),h(p,"class","svelte-b1nvja")},m(t,i){u(t,e,i),a(e,n),a(e,o),a(e,s),a(e,c),a(e,r),w&&w.m(r,null),u(t,l,i),u(t,p,i),~m&&_[m].m(p,null),g=!0},p(t,e){b===(b=v(0,e))&&w?w.p(t,e):(w&&w.d(1),(w=b&&b(e))&&(w.c(),w.m(r,null)));var n=m;(m=x(0,e))!==n&&($&&(S(),P(_[n],1,1,()=>{_[n]=null}),D()),~m?(($=_[m])||($=_[m]=y[m](e)).c(),O($,1),$.m(p,null)):$=null)},i(t){g||(O($),g=!0)},o(t){P($),g=!1},d(t){t&&i(e),w&&w.d(),t&&(i(l),i(p)),~m&&_[m].d()}}}function _t(t,e,n){let o,s;r(t,V,t=>{n("$loggedIn",o=t)}),r(t,Q,t=>{n("$username",s=t)});let c=!o,a=!1;return{showLogin:c,showRegister:a,showLoginDialog:function(){n("showRegister",a=!1),n("showLogin",c=!0)},showRegisterDialog:function(){n("showLogin",c=!1),n("showRegister",a=!0)},$loggedIn:o,$username:s}}return new class extends J{constructor(t){super(),A(this,t,_t,yt,c,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
